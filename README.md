# Anigram

## Database Schema Design

![Anigram-api-schema]

[Anigram-api-schema]: ./static/Screenshot%202025-02-19%20at%206.07.26 PM.png

## API Documentation

## USER AUTHENTICATION/AUTHORIZATION

### All endpoints that require authentication

All endpoints that require a current user to be logged in.

- Request: endpoints that require authentication
- Error Response: Require authentication

  - Status Code: 401
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Authentication required"
    }
    ```

### All endpoints that require proper authorization

All endpoints that require authentication and the current user does not have the
correct role(s) or permission(s).

- Request: endpoints that require proper authorization
- Error Response: Require proper authorization

  - Status Code: 403
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Forbidden"
    }
    ```

### Get the Current User

Returns the information about the current user that is logged in.

- Require Authentication: false
- Request

  - Method: GET
  - Route path: /api/session
  - Body: none

- Successful Response when there is a logged in user

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "user": {
        "id": 1,
        "firstName": "John",
        "lastName": "Smith",
        "email": "john.smith@gmail.com",
        "username": "JohnSmith"
      }
    }
    ```

- Successful Response when there is no logged in user

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "user": null
    }
    ```

### Log In a User

Logs in a current user with valid credentials and returns the current user's
information.

- Require Authentication: false
- Request

  - Method: POST
  - Route path: /api/session
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "credential": "john.smith@gmail.com",
      "password": "secret password"
    }
    ```

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "user": {
        "id": 1,
        "firstName": "John",
        "lastName": "Smith",
        "email": "john.smith@gmail.com",
        "username": "JohnSmith"
      }
    }
    ```

- Error Response: Invalid credentials

  - Status Code: 401
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Invalid credentials"
    }
    ```

- Error response: Body validation errors

  - Status Code: 400
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Bad Request", // (or "Validation error" if generated by Sequelize),
      "errors": {
        "credential": "Email or username is required",
        "password": "Password is required"
      }
    }
    ```

### Sign Up a User

Creates a new user, logs them in as the current user, and returns the current
user's information.

- Require Authentication: false
- Request

  - Method: POST
  - Route path: /api/users
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "firstName": "John",
      "lastName": "Smith",
      "email": "john.smith@gmail.com",
      "username": "JohnSmith",
      "password": "secret password"
    }
    ```

- Successful Response

  - Status Code: 201
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "user": {
        "id": 1,
        "firstName": "John",
        "lastName": "Smith",
        "email": "john.smith@gmail.com",
        "username": "JohnSmith"
      }
    }
    ```

- Error response: User already exists with the specified email or username

  - Status Code: 500
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "User already exists",
      "errors": {
        "email": "User with that email already exists",
        "username": "User with that username already exists"
      }
    }
    ```

- Error response: Body validation errors

  - Status Code: 400
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Bad Request", // (or "Validation error" if generated by Sequelize),
      "errors": {
        "email": "Invalid email",
        "username": "Username is required",
        "firstName": "First Name is required",
        "lastName": "Last Name is required"
      }
    }
    ```

## Follows

### Get the current user's complete follow list

Returns the current user's follows list.

- Require Authentication: true
- Request

  - Method: GET
  - Route path: '/api/follows/:userId'
  - Body: none

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "Following": [
        {
          "id": 1,
          "user_id": 1,
          "user_username": "Demo",
          "followed_user_id": 2,
          "followed_user_username": "Marnie"
        }
      ],
      "Followers": [
        {
          "id": 1,
          "user_id": 3,
          "user_username": "Bobbie",
          "followed_user_id": 1,
          "followed_user_username": "Demo"
        }
      ]
    }
    ```

### POST - have the current user follow another user

Returns the current user's updated follows list.

- Require Authentication: true
- Request

  - Method: POST
  - Route path: '/api/follows/:userId/:otherUserId/follow'
  - Body: none

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "Following": [
        {
          "id": 1,
          "user_id": 1,
          "user_username": "Demo",
          "followed_user_id": 2,
          "followed_user_username": "Marnie"
        }
        {
          "id": 1,
          "user_id": 1,
          "user_username": "Demo",
          "followed_user_id": 3,
          "followed_user_username": "Bobbie"
        }
      ],
      "Followers": [
        {
          "id": 1,
          "user_id": 3,
          "user_username": "Bobbie",
          "followed_user_id": 1,
          "followed_user_username": "Demo"
        }
      ]
    }
    ```

### POST - have the current user unfollow another user

Returns the current user's updated follows list.

- Require Authentication: true
- Request

  - Method: POST
  - Route path: '/api/follows/:userId/:otherUserId/unfollow'
  - Body: none

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "Following": [
        {
          "id": 1,
          "user_id": 1,
          "user_username": "Demo",
          "followed_user_id": 3,
          "followed_user_username": "Bobbie"
        }
      ],
      "Followers": [
        {
          "id": 1,
          "user_id": 3,
          "user_username": "Bobbie",
          "followed_user_id": 1,
          "followed_user_username": "Demo"
        }
      ]
    }
    ```

## Watchlist

### GET

Returns the watchlist of the current user by name

- Require Authentication: true
- Request

  - Method: GET
  - Body: none
  - Route path: '/api/watchlists/:userId/load'

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

      ```json

        {
            "id": 1,
            "user_id": 1,
            "name": "Plan to watch",
              "anime": [{
              "id": 3,
              "image_url": "https://cdn.myanimelist.net/images/anime/1141/142503l.jpg",
              "likes": 0,
              "mal_id": 20,
              "mal_url": "https://myanimelist.net/anime/20/Naruto",
              "producers": [{"mal_id": 16, "name": "TV Tokyo","type":"anime","url":"https://myanimelist.net/anime/producer/16/TV_Tokyo",}],"rating":"PG-13 - Teens 13 or older",
              "synopsis": "A long long time ago...",
              "title": "Naruto",
              "trailer_url": null,
              "watchlist_id": 1,

              }]
          }
        ```

### DELETE
Returns the updated watchlist of the current user by name

- Require Authentication: true
- Request

  - Method: DELETE
  - Body: none
  - Route path: '/api/watchlists/:userId/:watchlistId/:animeName'

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

      ```json

        {
            "id": 1,
            "user_id": 1,
            "name": "Plan to watch",
              "anime": [{
              "id": 3,
              "image_url": "https://cdn.myanimelist.net/images/anime/1141/142503l.jpg",
              "likes": 0,
              "mal_id": 20,
              "mal_url": "https://myanimelist.net/anime/20/Naruto",
              "producers": [{"mal_id": 16, "name": "TV Tokyo","type":"anime","url":"https://myanimelist.net/anime/producer/16/TV_Tokyo",}],"rating":"PG-13 - Teens 13 or older",
              "synopsis": "A long long time ago...",
              "title": "Naruto",
              "trailer_url": null,
              "watchlist_id": 1,

              }],
            "id": 2,
            "user_id": 1,
            "name": "Finished Watching",
              "anime": [{
              "id": 4,
              "image_url": "https://cdn.myanimelist.net/images/anime/1141/142503l.jpg",
              "likes": 0,
              "mal_id": 20,
              "mal_url": "https://myanimelist.net/anime/20/Naruto",
              "producers": [{"mal_id": 47, "name": "TV Tokyo","type":"anime","url":"https://myanimelist.net/anime/producer/16/TV_Tokyo",}],"rating":"PG-13 - Teens 13 or older",
              "synopsis": "A long long time ago...",
              "title": "Bleach",
              "trailer_url": null,
              "watchlist_id": 1,

              }]
          }
        ```

### POST
Returns the updated watchlist of the current user by name

- Require Authentication: true
- Request

  - Method: POST 
  - Body: none
  - Route path: '/api/watchlists/:userId/:watchlistId/:animeName/add'

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

      ```json

        {
            "id": 1,
            "user_id": 1,
            "name": "Plan to watch",
              "anime": [{
              "id": 3,
              "image_url": "https://cdn.myanimelist.net/images/anime/1141/142503l.jpg",
              "likes": 0,
              "mal_id": 20,
              "mal_url": "https://myanimelist.net/anime/20/Naruto",
              "producers": [{"mal_id": 16, "name": "TV Tokyo","type":"anime","url":"https://myanimelist.net/anime/producer/16/TV_Tokyo",}],"rating":"PG-13 - Teens 13 or older",
              "synopsis": "A long long time ago...",
              "title": "Naruto",
              "trailer_url": null,
              "watchlist_id": 1,

              }],
            "id": 2,
            "user_id": 1,
            "name": "Finished Watching",
              "anime": [{
              "id": 4,
              "image_url": "https://cdn.myanimelist.net/images/anime/1141/142503l.jpg",
              "likes": 0,
              "mal_id": 20,
              "mal_url": "https://myanimelist.net/anime/20/Naruto",
              "producers": [{"mal_id": 47, "name": "TV Tokyo","type":"anime","url":"https://myanimelist.net/anime/producer/16/TV_Tokyo",}],"rating":"PG-13 - Teens 13 or older",
              "synopsis": "A long long time ago...",
              "title": "Bleach",
              "trailer_url": null,
              "watchlist_id": 1,

              }]
          }
        ```



- Error response: Couldn't find an anime with the specified name

  - Status Code: 404
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Watchlist couldn't be found"
    }
    ```

## Anime

### POST
Search for anime through Jikan API by name and return an obj of that anime. 

- Require Authentication: true
- Request

  - Method: GET
  - Route path: /api/anime/:animeName/load
  - Headers:
    - Content-Type: application/json
  - Body:

    none

- Successful Response - redirect the user to the stock detail page

  - Status Code: 201
  - Headers:
    - Content-Type: application/json
  - Body:

    ````json
       ```json
    {
      "id": 1,
      "user_id": ,
      "watchlist_id": 1,
      "likes": 40,
      "title": "Attack on Titan",
      "image_url": "https://cdn.myanimelist.net/images/anime/1286/99889l.jpg",
      "rating": "PG-13 - Teens 13 or older",
      "synopsis": "Ever since the death of his father, the burden of supporting the family has fallen upon Tanjirou Kamado's shoulders. Though living impoverished on a remote mountain, the Kamado family are able to enjoy a relatively peaceful and happy life. One day, Tanjirou decides to go down to the local village to make a little money selling charcoal. On his way back, night falls, forcing Tanjirou to take shelter in the house of a strange man, who warns him of the existence of flesh-eating demons that lurk in the woods at night.

      When he finally arrives back home the next day, he is met with a horrifying sight—his whole family has been slaughtered. Worse still, the sole survivor is his sister Nezuko, who has been turned into a bloodthirsty demon. Consumed by rage and hatred, Tanjirou swears to avenge his family and stay by his only remaining sibling. Alongside the mysterious group calling themselves the Demon Slayer Corps, Tanjirou will do whatever it takes to slay the demons and protect the remnants of his beloved sister's humanity.

      [Written by MAL Rewrite]",
      "score": 8.2,
      "duration": "24 min per ep",
      "trailer_url": "https://www.youtube.com/watch?v=6vMuWuWlW4I",
      "mal_url": "https://myanimelist.net/anime/25777/Shingeki_no_Kyojin_Season_2",
      "mal_id": 25777,
    }
    ````


### GET
Query for all the anime in the database to load them. 

- Require Authentication: true
- Request

  - Method: GET
  - Route path: /api/anime/load/all
  - Headers:
    - Content-Type: application/json
  - Body:

    none

- Successful Response - Populate whichever page the user is on with anime from the database

  - Status Code: 201
  - Headers:
    - Content-Type: application/json
  - Body:

    ````json
       ```json
    {
      "id": 1,
      "user_id": ,
      "watchlist_id": 1,
      "likes": 40,
      "title": "Attack on Titan",
      "image_url": "https://cdn.myanimelist.net/images/anime/1286/99889l.jpg",
      "rating": "PG-13 - Teens 13 or older",
      "synopsis": "Ever since the death of his father, the burden of supporting the family has fallen upon Tanjirou Kamado's shoulders. Though living impoverished on a remote mountain, the Kamado family are able to enjoy a relatively peaceful and happy life. One day, Tanjirou decides to go down to the local village to make a little money selling charcoal. On his way back, night falls, forcing Tanjirou to take shelter in the house of a strange man, who warns him of the existence of flesh-eating demons that lurk in the woods at night.

      When he finally arrives back home the next day, he is met with a horrifying sight—his whole family has been slaughtered. Worse still, the sole survivor is his sister Nezuko, who has been turned into a bloodthirsty demon. Consumed by rage and hatred, Tanjirou swears to avenge his family and stay by his only remaining sibling. Alongside the mysterious group calling themselves the Demon Slayer Corps, Tanjirou will do whatever it takes to slay the demons and protect the remnants of his beloved sister's humanity.

      [Written by MAL Rewrite]",
      "score": 8.2,
      "duration": "24 min per ep",
      "trailer_url": "https://www.youtube.com/watch?v=6vMuWuWlW4I",
      "mal_url": "https://myanimelist.net/anime/25777/Shingeki_no_Kyojin_Season_2",
      "mal_id": 25777,
    }
    ````

- Error Response: Body validation errors

  - Status Code: 400
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Bad Request", // (or "Validation error" if generated by Sequelize),
      "errors": {
        "anime_name": "Anime not found"
      }
    }
    ```